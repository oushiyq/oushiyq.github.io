<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Daniel Young&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Daniel Young's blog">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Daniel Young's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Daniel Young's blog">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Daniel Young&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://7xqzfr.com1.z0.glb.clouddn.com/221_FfjKG6931FeJ3e2GkzbG_square.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Daniel Young</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>標籤</li>
						
						
						<li>關於</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="/#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">逗逼一枚…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Daniel Young</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://7xqzfr.com1.z0.glb.clouddn.com/221_FfjKG6931FeJ3e2GkzbG_square.png" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">Daniel Young</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="/#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="/#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="/#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-深入理解KVO" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/16/深入理解KVO/" class="article-date">
  	<time datetime="2016-03-16T12:03:19.000Z" itemprop="datePublished">2016-03-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/16/深入理解KVO/">简单使用KVO</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-_KVC_u7684_u6982_u5FF5"><a href="#1-_KVC_u7684_u6982_u5FF5" class="headerlink" title="1. KVC的概念"></a>1. KVC的概念</h2><p>KVC（key-value coding）是指将表示对象包含的信息的字符串作为键值来使用，间接访问该信息的方式。</p>
<h2 id="2-_KVO_u4E0ERuntime"><a href="#2-_KVO_u4E0ERuntime" class="headerlink" title="2. KVO与Runtime"></a>2. KVO与Runtime</h2><p>KVO（key-value observe）即某个对象的属性改变时通知其他对象的机制。KVO的实现也依赖于Objective-C的Runtime，官方文档《Key-Value Observing Programming Guide》中在《Key-Value Observing Implementation Details》部分简单提到它的实现：</p>
<hr>
<p>Automatic key-value observing is implemented using a technique called isa-swizzling.</p>
<p>The isa pointer, as the name suggests, points to the object’s class which maintains a dispatch table. This dispatch table essentially contains pointers to the methods the class implements, among other data.</p>
<p>When an observer is registered for an attribute of an object the isa pointer of the observed object is modified, pointing to an intermediate class rather than at the true class. As a result the value of the isa pointer does not necessarily reflect the actual class of the instance.</p>
<p>You should never rely on the isa pointer to determine class membership. Instead, you should use the class method to determine the class of an object instance.</p>
<hr>
<p>大概的意思就是KVO的实现是通过isa-swizzling技术。这个技术表示，当观察者观察一个对象时，会产生一个新的类，这个类继承于被观察对象，并重写其setter方法，再将被观察对象的isa指针指向新的类。这样被观察对象就神奇的成为了新类的实例。这样看来，KVO的实现还是有点黑魔法的意思啊。</p>
<h2 id="3-_KVO_u7684_u4F7F_u7528"><a href="#3-_KVO_u7684_u4F7F_u7528" class="headerlink" title="3. KVO的使用"></a>3. KVO的使用</h2><h3 id="3-1__u8BA2_u9605"><a href="#3-1__u8BA2_u9605" class="headerlink" title="3.1 订阅"></a>3.1 订阅</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)addObserver:(<span class="built_in">NSObject</span> *)observer</span><br><span class="line">         forKeyPath:(<span class="built_in">NSString</span> *)keyPath</span><br><span class="line">            options:(<span class="built_in">NSKeyValueObservingOptions</span>)options</span><br><span class="line">            context:(<span class="keyword">void</span> *)context;</span><br></pre></td></tr></table></figure>
<h3 id="3-2__u54CD_u5E94"><a href="#3-2__u54CD_u5E94" class="headerlink" title="3.2 响应"></a>3.2 响应</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath</span><br><span class="line">                      ofObject:(<span class="keyword">id</span>)object</span><br><span class="line">                        change:(<span class="built_in">NSDictionary</span> *)change</span><br><span class="line">                       context:(<span class="keyword">void</span> *)context;</span><br></pre></td></tr></table></figure>
<h3 id="3-3__u79FB_u9664"><a href="#3-3__u79FB_u9664" class="headerlink" title="3.3 移除"></a>3.3 移除</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="built_in">NSObject</span> *)observer</span><br><span class="line">            forKeyPath:(<span class="built_in">NSString</span> *)keyPath</span><br><span class="line">               context:(<span class="keyword">void</span> *)context;</span><br><span class="line">               </span><br><span class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="built_in">NSObject</span> *)observer</span><br><span class="line">            forKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br></pre></td></tr></table></figure>
<h3 id="3-4__u793A_u4F8B_u7A0B_u5E8F"><a href="#3-4__u793A_u4F8B_u7A0B_u5E8F" class="headerlink" title="3.4 示例程序"></a>3.4 示例程序</h3><p>在下面的例子中，通过对UITextField.text值的观察，当其变化时，新值将在弹出窗口中被打印出来。效果如下：<br><img src="http://7xqzfr.com1.z0.glb.clouddn.com/2016-03-17%2009_36_54.gif" alt=""></p>
<p>以下是源代码：<br>h文件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *showText;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) IBOutletCollection(<span class="built_in">UIButton</span>) <span class="built_in">NSArray</span> *numberButton;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)clickNumberButton:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>m文件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    [<span class="keyword">self</span> addObserver:<span class="keyword">self</span></span><br><span class="line">           forKeyPath:<span class="string">@"showText.text"</span></span><br><span class="line">              options:<span class="number">1</span></span><br><span class="line">              context:<span class="literal">NULL</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)clickNumberButton:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="built_in">NSUInteger</span> buttonIndex = [<span class="keyword">self</span><span class="variable">.numberButton</span> indexOfObject:sender];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *content = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%lu"</span>,(<span class="keyword">unsigned</span> <span class="keyword">long</span>)buttonIndex ];</span><br><span class="line">    [content stringByAppendingFormat:<span class="string">@"%lu"</span>,(<span class="keyword">unsigned</span> <span class="keyword">long</span>)buttonIndex];</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.showText</span><span class="variable">.text</span> = [<span class="keyword">self</span><span class="variable">.showText</span><span class="variable">.text</span> stringByAppendingString:content];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath</span><br><span class="line">                      ofObject:(<span class="keyword">id</span>)object</span><br><span class="line">                        change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)change</span><br><span class="line">                       context:(<span class="keyword">void</span> *)context&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *currentString = [change valueForKey:<span class="string">@"new"</span>];</span><br><span class="line">    <span class="comment">//弹窗</span></span><br><span class="line">    <span class="built_in">UIAlertController</span> *alertController = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:<span class="string">@"输入的数字为："</span></span><br><span class="line">                                                                             message:currentString</span><br><span class="line">                                                                      preferredStyle:<span class="built_in">UIAlertControllerStyleAlert</span>];</span><br><span class="line">    <span class="built_in">UIAlertAction</span> *cancelAction = [<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"取消"</span></span><br><span class="line">                                                           style:<span class="built_in">UIAlertActionStyleCancel</span></span><br><span class="line">                                                         handler:<span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">UIAlertAction</span> *okAction = [<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"好的"</span></span><br><span class="line">                                                       style:<span class="built_in">UIAlertActionStyleDefault</span></span><br><span class="line">                                                     handler:<span class="literal">nil</span>];</span><br><span class="line">    [alertController addAction:cancelAction];</span><br><span class="line">    [alertController addAction:okAction];</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:alertController animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-4__u6CE8_u610F_u4E8B_u9879"><a href="#3-4__u6CE8_u610F_u4E8B_u9879" class="headerlink" title="3.4 注意事项"></a>3.4 注意事项</h2><ol>
<li>keypath的拼写。因为keypath为一字符串，所以很容易产生拼写错误导致无法监听。比如本来keypath = @”contents”，但有时未注意可能会拼写成keypath = @”content”，而编译器在编译时也无法发现错误。因此可以定义一个常量static const NSString *contens = @”contents”；</li>
<li>多次使用removeObserver导致程序crash。在同一个文件中执行两次相同的removeObserver比较容易debug出来；但是跨文件执行两次相同的removeObserver就不是那么容易发现了。因此Apple推荐在dealloc中进行removeObserver；</li>
</ol>
<p>参考资料：</p>
<ol>
<li>Key-Value Observing Programming Guide</li>
<li><a href="http://objccn.io/issue-7-3/" target="_blank" rel="external">KVC 和 KVO</a> 翻译：卢思豪 </li>
<li><a href="http://khanlou.com/2013/12/kvo-considered-harmful/" target="_blank" rel="external">KVO Considered Harmful</a> KHANLOU</li>
<li>《Objective-C编程全解》 荻原刚志</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-ARC模式下的OC对象与Core-Fundation的桥接" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/11/ARC模式下的OC对象与Core-Fundation的桥接/" class="article-date">
  	<time datetime="2016-03-11T10:36:26.000Z" itemprop="datePublished">2016-03-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/11/ARC模式下的OC对象与Core-Fundation的桥接/">ARC模式下的OC对象与Core Fundation的桥接</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="u4EC0_u4E48_u662FToll_Free_Bridge"><a href="#u4EC0_u4E48_u662FToll_Free_Bridge" class="headerlink" title="什么是Toll_Free Bridge"></a>什么是Toll_Free Bridge</h3><p>通常来说为了代码在底层级上的正确，在iOS开发中对基于C的API的调用所传入的参数一般都是CF对象，而Objective-C的API调用都是传入NSObject对象。因此在采用toll_free bridge来调用C语言API的时候就需要进行转换。但是在使用ARC编译的时候，因为内存管理的原因，编译器需要知道对这些桥接对象要实行什么样的操作。如果一个NSURL对象替代了CFURLRef，那么在作用区域外，应该由谁来决定内存释放和对象销毁呢？为了解决这个问题，引入了<strong>bridge,bridge_transfer和</strong>bridge_retained三个关键字。关于选取哪个关键字做转换，需要由实际的代码行为来决定。</p>
<h3 id="Bridge_u5173_u952E_u5B57"><a href="#Bridge_u5173_u952E_u5B57" class="headerlink" title="Bridge关键字"></a>Bridge关键字</h3><ul>
<li><p>__bridge：用来完成CF和OC对象的转换，不涉及对象所有权的改变</p>
</li>
<li><p>__bridge_transfer：用来完成CF到OC对象的转换，给予ARC拥有对象，无需手动释放</p>
</li>
<li><p>__bridge_retained：用来完成OC对象到CF的转换，解除ARC对于对象的拥有，需手动释放</p>
</li>
</ul>
<p>参考资料：<br><a href="http://gracelancy.com/blog/2014/04/21/toll-free-bridging/" target="_blank" rel="external">Toll-Free Bridging</a> Lancy<br><a href="https://onevcat.com/2012/06/arc-hand-by-hand/" target="_blank" rel="external">手把手教你ARC——iOS/Mac开发ARC入门和使用</a> OneV’s Den</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-我所理解的RunLoop" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/11/我所理解的RunLoop/" class="article-date">
  	<time datetime="2016-03-11T06:35:07.000Z" itemprop="datePublished">2016-03-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/11/我所理解的RunLoop/">我所理解的RunLoop</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="u8D77_u56E0"><a href="#u8D77_u56E0" class="headerlink" title="起因"></a>起因</h3><p>一直都知道RunLoop是个非常重要的点，可是自己在实际开发中一直都没有遇到。而且对其一直都抱着高山仰止的态度，感觉RunLoop对于我来说是一个特别难理解的东西。但是，就在昨天接到了腾讯的电面，一开始就问我『是否知道什么是RunLoop』，还好RunLoop的概念我还是很熟，回答了上来；接下来，HR又问『RunLoop和多线程的关系』，直接蒙圈了。于是，自己疼定思疼，狠狠的把之前找到的关于RunLoop资料拿出来重新一点一点的看了下去，总算是有点理解了RunLoop吧。</p>
<h2 id="1-__u4EC0_u4E48_u662FRunLoop"><a href="#1-__u4EC0_u4E48_u662FRunLoop" class="headerlink" title="1. 什么是RunLoop"></a>1. 什么是RunLoop</h2><p>在通常情况下，一次线程只能处理一个任务，当任务完成，线程也就结束了，这样的线程如图1.1所示。但是，这样的线程并不是我们总需要的，我们需要有线程可以一直等待我们的操作，相当于一个do-while语句。当我们需要结束进程时，线程才结束，这样的线程如图1.2所示。<br><img src="http://7xqzfr.com1.z0.glb.clouddn.com/1.1.png?imageView/2/w/800/q/90" alt="图1.1"> <img src="http://7xqzfr.com1.z0.glb.clouddn.com/1.2.png?imageView/2/w/800/q/90" alt="图1.2"><br>图1.2所示的模型被称为Event Loop，也就是iOS系统中的RunLoop。RunLoop在没有任务处理的时候sleep，而有任务进来是被唤醒。<br>在iOS系统中，提供了两个这样的对象：NSRunLoop 和 CFRunLoopRef。<br>CFRunLoopRef 是在 CoreFoundation 框架内的，它提供了纯 C 函数的 API，所有这些 API 都是线程安全的。<br>NSRunLoop 是基于 CFRunLoopRef 的封装，提供了面向对象的 API，但是这些 API 不是线程安全的。</p>
<h2 id="2-__u4E3A_u4EC0_u4E48_u6211_u4EEC_u9700_u8981RunLoop"><a href="#2-__u4E3A_u4EC0_u4E48_u6211_u4EEC_u9700_u8981RunLoop" class="headerlink" title="2. 为什么我们需要RunLoop"></a>2. 为什么我们需要RunLoop</h2><ul>
<li>使程序一直运行并接受用户输入</li>
<li>决定程序在何时应该处理哪些Event</li>
<li>调用解耦</li>
<li>节约CPU时间</li>
</ul>
<h2 id="3-_RunLoop_u4E0E_u7EBF_u7A0B_u7684_u5173_u7CFB"><a href="#3-_RunLoop_u4E0E_u7EBF_u7A0B_u7684_u5173_u7CFB" class="headerlink" title="3. RunLoop与线程的关系"></a>3. RunLoop与线程的关系</h2><p>在iOS程序中，主线程自带一个RunLoop，如下列代码所示：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"AppDelegate.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">UIApplicationMain</span>(argc, argv, <span class="literal">nil</span>, <span class="built_in">NSStringFromClass</span>([AppDelegate class]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在Xcode创建一个project时，系统会自动生成的一个main函数，初始化UIApplicationMain后，便开启了RunLoop。而在其他线程中，则需要自己『获取』一个RunLoop。线程和RunLoop一一对应。这里为什么需要强调『获取』，而不是创建呢？因为苹果不允许直接创建RunLoop，它只提供了两个自动获取的函数：CFRunLoopGetMain() 和 CFRunLoopGetCurrent()。</p>
<h2 id="4-_RunLoop_u7684_u6784_u6210_u5143_u7D20"><a href="#4-_RunLoop_u7684_u6784_u6210_u5143_u7D20" class="headerlink" title="4. RunLoop的构成元素"></a>4. RunLoop的构成元素</h2><p><img src="http://7xqzfr.com1.z0.glb.clouddn.com/4.1.png?imageView/2/w/800/q/90" alt="图4.1"><br>如图所示，一个RunLoop可以包含多个Mode，而一个Mode可以包含多个Source/Timer/Observer。每次RunLoop只能调用一个Mode，如果需要切换Mode，那么得先退出Loop，再切换Mode重新进入Loop。</p>
<h3 id="4-1_CFRunLoopMode"><a href="#4-1_CFRunLoopMode" class="headerlink" title="4.1 CFRunLoopMode"></a>4.1 CFRunLoopMode</h3><p>CFRunLoopMode 和 CFRunLoop 的结构大致如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> __<span class="built_in">CFRunLoopMode</span> &#123;</span><br><span class="line">    <span class="built_in">CFStringRef</span> _name;            <span class="comment">// Mode Name, 例如 @"kCFRunLoopDefaultMode"</span></span><br><span class="line">    <span class="built_in">CFMutableSetRef</span> _sources0;    <span class="comment">// Set</span></span><br><span class="line">    <span class="built_in">CFMutableSetRef</span> _sources1;    <span class="comment">// Set</span></span><br><span class="line">    <span class="built_in">CFMutableArrayRef</span> _observers; <span class="comment">// Array</span></span><br><span class="line">    <span class="built_in">CFMutableArrayRef</span> _timers;    <span class="comment">// Array</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">struct</span> __<span class="built_in">CFRunLoop</span> &#123;</span><br><span class="line">    <span class="built_in">CFMutableSetRef</span> _commonModes;     <span class="comment">// Set</span></span><br><span class="line">    <span class="built_in">CFMutableSetRef</span> _commonModeItems; <span class="comment">// Set&lt;Source/Observer/Timer&gt;</span></span><br><span class="line">    <span class="built_in">CFRunLoopModeRef</span> _currentMode;    <span class="comment">// Current Runloop Mode</span></span><br><span class="line">    <span class="built_in">CFMutableSetRef</span> _modes;           <span class="comment">// Set</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这里有个概念叫 “CommonModes”：一个 Mode 可以将自己标记为”Common”属性（通过将其 ModeName 添加到 RunLoop 的 “commonModes” 中）。每当 RunLoop 的内容发生变化时，RunLoop 都会自动将 _commonModeItems 里的 Source/Observer/Timer 同步到具有 “Common” 标记的所有Mode里。</p>
<p>应用场景举例：主线程的 RunLoop 里有两个预置的 Mode：kCFRunLoopDefaultMode 和 UITrackingRunLoopMode。这两个 Mode 都已经被标记为”Common”属性。DefaultMode 是 App 平时所处的状态，TrackingRunLoopMode 是追踪 ScrollView 滑动时的状态。当你创建一个 Timer 并加到 DefaultMode 时，Timer 会得到重复回调，但此时滑动一个TableView时，RunLoop 会将 mode 切换为 TrackingRunLoopMode，这时 Timer 就不会被回调，并且也不会影响到滑动操作。</p>
<p>有时你需要一个 Timer，在两个 Mode 中都能得到回调，一种办法就是将这个 Timer 分别加入这两个 Mode。还有一种方式，就是将 Timer 加入到顶层的 RunLoop 的 “commonModeItems” 中。”commonModeItems” 被 RunLoop 自动更新到所有具有”Common”属性的 Mode 里去。</p>
<h3 id="4-2_CFRunLoopSourceRef"><a href="#4-2_CFRunLoopSourceRef" class="headerlink" title="4.2 CFRunLoopSourceRef"></a>4.2 CFRunLoopSourceRef</h3><p>CFRunLoopSourceRef 是事件产生的地方。Source有两个版本：Source0 和 Source1。</p>
<ul>
<li>source0：处理如UIEvent，CFSocket这样的事件</li>
<li>source1：Mach port驱动，CFMachport，CFMessagePort</li>
</ul>
<h3 id="4-3_CFRunLoopTimerRef"><a href="#4-3_CFRunLoopTimerRef" class="headerlink" title="4.3 CFRunLoopTimerRef"></a>4.3 CFRunLoopTimerRef</h3><p>CFRunLoopTimerRef 是基于时间的触发器，它和 NSTimer 是toll-free bridged 的，可以混用。其包含一个时间长度和一个回调（函数指针）。当其加入到 RunLoop 时，RunLoop会注册对应的时间点，当时间点到时，RunLoop会被唤醒以执行那个回调。<br>另外，需要注意的是，当GCD进行dispatch主线程时，他的Timer和RunLoop的Timer分别执行。</p>
<h3 id="4-4_RunLoopObserver"><a href="#4-4_RunLoopObserver" class="headerlink" title="4.4 RunLoopObserver"></a>4.4 RunLoopObserver</h3><p>Cocoa框架中很多机制比如CAAnimation等都是由RunLoopObserver触发的。observer到当前状态的变化进行通知。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="built_in">CF_OPTIONS</span>(<span class="built_in">CFOptionFlags</span>, <span class="built_in">CFRunLoopActivity</span>) &#123;</span><br><span class="line">     k<span class="built_in">CFRunLoopEntry</span> = (<span class="number">1</span>UL &lt;&lt; <span class="number">0</span>),</span><br><span class="line">     k<span class="built_in">CFRunLoopBeforeTimers</span> = (<span class="number">1</span>UL &lt;&lt; <span class="number">1</span>),</span><br><span class="line">     k<span class="built_in">CFRunLoopBeforeSources</span> = (<span class="number">1</span>UL &lt;&lt; <span class="number">2</span>),</span><br><span class="line">     k<span class="built_in">CFRunLoopBeforeWaiting</span> = (<span class="number">1</span>UL &lt;&lt; <span class="number">5</span>),</span><br><span class="line">     k<span class="built_in">CFRunLoopAfterWaiting</span> = (<span class="number">1</span>UL &lt;&lt; <span class="number">6</span>),</span><br><span class="line">     k<span class="built_in">CFRunLoopExit</span> = (<span class="number">1</span>UL &lt;&lt; <span class="number">7</span>),</span><br><span class="line">     k<span class="built_in">CFRunLoopAllActivities</span> = <span class="number">0x0FFFFFFF</span>U</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="5-_RunLoop_u7684sleep_u548C_u5524_u9192"><a href="#5-_RunLoop_u7684sleep_u548C_u5524_u9192" class="headerlink" title="5. RunLoop的sleep和唤醒"></a>5. RunLoop的sleep和唤醒</h2><ul>
<li>指定用于唤醒的mach_port端口；</li>
<li>调用mach_msg()监听唤醒端口，在唤醒前，该线程sleep，停留在mach_msg_trap状态；</li>
<li>由其他线程向内核发送mach_port端口的msg后，该线程被唤醒。</li>
</ul>
<p>RunLoop 的核心就是一个mach_msg()，RunLoop调用这个函数去接收消息，如果没有别人发送port消息过来，内核会将线程置于sleep状态。</p>
<h2 id="6-_RunLoop_u7684_u6267_u884C_u987A_u5E8F"><a href="#6-_RunLoop_u7684_u6267_u884C_u987A_u5E8F" class="headerlink" title="6. RunLoop的执行顺序"></a>6. RunLoop的执行顺序</h2><p><img src="http://7xqzfr.com1.z0.glb.clouddn.com/6.1.png?imageView/2/w/800/q/90" alt="图6.1"></p>
<p>可以看到，实际上 RunLoop 就是这样一个函数，其内部是一个 do-while 循环。当你调用 CFRunLoopRun() 时，线程就会一直停留在这个循环里；直到超时或被手动停止，该函数才会返回。</p>
<h2 id="7-__u603B_u7ED3"><a href="#7-__u603B_u7ED3" class="headerlink" title="7. 总结"></a>7. 总结</h2><p>上面的文字大多都是综合参考资料中的两篇博客，加上了一点自己对于RunLoop的理解合成了这篇文章。</p>
<p>参考资料：</p>
<p>1.<a href="http://blog.ibireme.com/2015/05/18/runloop/" target="_blank" rel="external">深入理解RunLoop</a> ibireme<br>2.<a href="http://yun.baidu.com/share/home?uk=2885973690" target="_blank" rel="external">sunnyxx的视频runloop.mov</a> sunnyxx</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-浅析category和class-extension" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/07/浅析category和class-extension/" class="article-date">
  	<time datetime="2016-03-07T11:42:52.000Z" itemprop="datePublished">2016-03-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/07/浅析category和class-extension/">浅析category和class extension</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u5199_u5728_u524D_u9762"><a href="#u5199_u5728_u524D_u9762" class="headerlink" title="写在前面"></a>写在前面</h2><p>一直都在用继承来扩展类的功能，后来发现原来还有category和class extension这种更加简洁的方法来实现对class的扩展。但是对于其实现以及二者的区别并不大了解，网上的资料也写的比较简单，但是category和class extension的内容其实还是比较丰富的，为了帮助其他一些新手了解这俩，并为以后有需求时翻翻。于是写下这篇文章。</p>
<h2 id="u58F0_u660E_u4E0E_u5B9E_u73B0"><a href="#u58F0_u660E_u4E0E_u5B9E_u73B0" class="headerlink" title="声明与实现"></a>声明与实现</h2><h3 id="category_uFF1A"><a href="#category_uFF1A" class="headerlink" title="category："></a>category：</h3><ol>
<li><p>声明：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">className</span> (<span class="title">categoryName</span>)</span></span><br><span class="line"><span class="comment">//方法声明</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>实现</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">className</span> (<span class="title">categoryName</span>)</span></span><br><span class="line"><span class="comment">//方法实现</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="class_extension_uFF1A"><a href="#class_extension_uFF1A" class="headerlink" title="class extension："></a>class extension：</h3><ol>
<li>声明：<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">className</span> ()</span></span><br><span class="line"><span class="comment">//方法声明</span></span><br><span class="line"><span class="comment">//实例变量声明</span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>从上面category和class extension的声明和实现可以看出，class extension在语法上相当于匿名的category。不过category无法声明实例变量，而extension申明的实例变量和方法需要在主类中实现。</p>
<h2 id="category_u548Cclass_extension_u7684_u533A_u522B"><a href="#category_u548Cclass_extension_u7684_u533A_u522B" class="headerlink" title="category和class extension的区别"></a>category和class extension的区别</h2><table>
<thead>
<tr>
<th></th>
<th style="text-align:center">ivar</th>
<th style="text-align:right">method</th>
</tr>
</thead>
<tbody>
<tr>
<td>class.h</td>
<td style="text-align:center">public</td>
<td style="text-align:right">public</td>
</tr>
<tr>
<td>class.m</td>
<td style="text-align:center">privated</td>
<td style="text-align:right">privated</td>
</tr>
<tr>
<td>category.h</td>
<td style="text-align:center">none</td>
<td style="text-align:right">public</td>
</tr>
<tr>
<td>category.m</td>
<td style="text-align:center">none</td>
<td style="text-align:right">privated</td>
</tr>
<tr>
<td>extension.h</td>
<td style="text-align:center">protected</td>
<td style="text-align:right">protected</td>
</tr>
</tbody>
</table>
<h2 id="u5173_u8054_u5F15_u7528"><a href="#u5173_u8054_u5F15_u7528" class="headerlink" title="关联引用"></a>关联引用</h2><h3 id="u6982_u5FF5"><a href="#u6982_u5FF5" class="headerlink" title="概念"></a>概念</h3><p>通过category可以为yi一个类追加新的方法但不能追加实例变量。但是，利用Objective-C语言的动态性，并借助runtime的功能，就可以为已存在的实例对象增加实例变量，这个功能叫做关联引用（associative references)。</p>
<h3 id="u6DFB_u52A0_u548C_u68C0_u7D22_u5173_u8054"><a href="#u6DFB_u52A0_u548C_u68C0_u7D22_u5173_u8054" class="headerlink" title="添加和检索关联"></a>添加和检索关联</h3><p>此方法是为对象object添加key为地址，value为值的关联引用，第四个参数policy指定关联引用的存储策略。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> objc_setAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key, <span class="keyword">id</span> value, objc_AssociationPolicy policy)</span><br></pre></td></tr></table></figure></p>
<p>返回object以key为地址关联的对象，如果没有关联到任何对象返回nil。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">id</span> objc_getAssociatedObject(<span class="keyword">id</span> object, <span class="keyword">const</span> <span class="keyword">void</span> *key)</span><br></pre></td></tr></table></figure></p>
<h3 id="u7ED9_u73B0_u6709_u7C7B_u8FFD_u52A0category"><a href="#u7ED9_u73B0_u6709_u7C7B_u8FFD_u52A0category" class="headerlink" title="给现有类追加category"></a>给现有类追加category</h3><p>我们一般通过继承的方式来给现有类增加新的功能，但有时候使用子类并不方便。例如无法用通常的方法来为NSString创建子类。通过category给现有类追加方法后，这个类的子类不需要做任何修改就能够使用新追加的方法。下面给出一个实例：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSArray</span>(<span class="title">Random</span>)</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)anyone;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#import <span class="title">"NSArray+Random.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSArray</span>(<span class="title">Random</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> prevKey;</span><br><span class="line">- (<span class="keyword">id</span>)anyone</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">id</span> item;</span><br><span class="line">    <span class="built_in">NSUInteger</span> count = [<span class="keyword">self</span> count];</span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">1</span>) &#123;</span><br><span class="line">        item = [<span class="keyword">self</span> lastObject];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">id</span> prev = objc_getAssociatedObject(<span class="keyword">self</span>, &amp;prevKey);</span><br><span class="line">        <span class="built_in">NSUInteger</span> index = arc4random() % count;</span><br><span class="line">        item = [<span class="keyword">self</span> objectAtIndex:index];</span><br><span class="line">        <span class="keyword">if</span> (item == prev) &#123;</span><br><span class="line">            <span class="keyword">if</span> (++index &gt;= count) index = <span class="number">0</span>;</span><br><span class="line">            item = [<span class="keyword">self</span> objectAtIndex:index];</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    objc_setAssociatedObject(<span class="keyword">self</span>, &amp;prevKey, item, OBJC_ASSO<span class="built_in">CIATION_RETAIN</span>);</span><br><span class="line">    <span class="keyword">return</span> item;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">"NSArray+Random.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="keyword">id</span> arr1 = [<span class="built_in">NSArray</span> arrayWithObjects:<span class="string">@"A"</span>, <span class="string">@"B"</span>, <span class="string">@"C"</span>, <span class="string">@"D"</span>, <span class="string">@"E"</span>, <span class="string">@"F"</span>, <span class="literal">nil</span>];</span><br><span class="line">        <span class="keyword">id</span> arr2 = [<span class="built_in">NSArray</span> arrayWithObjects:<span class="string">@"1"</span>, <span class="string">@"2"</span>, <span class="string">@"3"</span>, <span class="string">@"4"</span>, <span class="string">@"5"</span>, <span class="string">@"6"</span>, <span class="literal">nil</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">             printf(<span class="string">"%s %s\n"</span>, [[arr1 anyone] UTF8String], [[arr2 anyone] UTF8String]);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">           &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    输出结果:</span></span><br><span class="line"><span class="comment">//    F 1</span></span><br><span class="line"><span class="comment">//    A 6</span></span><br><span class="line"><span class="comment">//    B 4</span></span><br><span class="line"><span class="comment">//    D 5</span></span><br><span class="line"><span class="comment">//    F 2</span></span><br><span class="line"><span class="comment">//    D 3</span></span><br></pre></td></tr></table></figure></p>
<p>在上例中，我为NSArry增加了一个anyone的方法，随机取NSArry中的元素，所取的元素可以相同，但不可以连续取得相同元素。在上例，我们也可以看到category的命名规范，NSArray+Random，主类+category。</p>
<p>参考资料：《Objective-C编程全解》 荻原刚志</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-copy没那么简单" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/28/copy没那么简单/" class="article-date">
  	<time datetime="2016-02-28T12:13:09.000Z" itemprop="datePublished">2016-02-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/28/copy没那么简单/">copy没那么简单</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="NSCopying_u548CNSMutableCopying_u534F_u8BAE"><a href="#NSCopying_u548CNSMutableCopying_u534F_u8BAE" class="headerlink" title="NSCopying和NSMutableCopying协议"></a>NSCopying和NSMutableCopying协议</h2><p>曾经天真的以为copy可以直接拿来用就行了，然而Xcode编译给我了一记重拳。于是上网搜资料才发现，你要是想使用copy，那么NSObject类必须遵守NSCopying或NSMutableCopying协议。下面给出他俩的API：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)<span class="keyword">copy</span>;</span><br><span class="line">- (<span class="keyword">id</span>)mutableCopy;</span><br><span class="line">	</span><br><span class="line">+ (<span class="keyword">id</span>)copyWithZone:(<span class="keyword">struct</span> _<span class="built_in">NSZone</span> *)zone;</span><br><span class="line">+ (<span class="keyword">id</span>)mutableCopyWithZone:(<span class="keyword">struct</span> _<span class="built_in">NSZone</span> *)zone;</span><br></pre></td></tr></table></figure></p>
<p>另外，再给出具体实现，如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">userName</span> : <span class="title">NSObject</span>&lt;<span class="title">NSCopying</span>,<span class="title">NSMutableCopying</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span>* firstName;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span>* lastame;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSMutableString</span>* mutableFirstName;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSMutableString</span>* mutableLastame;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">userName</span></span></span><br><span class="line"></span><br><span class="line">- (instancetype)initWithFirstName:(<span class="built_in">NSString</span> *)firstName</span><br><span class="line">                      andLastName:(<span class="built_in">NSString</span> *)lastName&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) &#123;</span><br><span class="line">        _firstName = [firstName <span class="keyword">copy</span>];</span><br><span class="line">        _lastame = [lastName <span class="keyword">copy</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (instancetype)initWithMutableFirstName:(<span class="built_in">NSString</span> *)mutableFirstName</span><br><span class="line">                       andMutableLastame:(<span class="built_in">NSString</span> *)MutableLastName&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>) &#123;</span><br><span class="line">        _firstName = [mutableFirstName mutableCopy];</span><br><span class="line">        _lastame = [MutableLastName mutableCopy];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#pragma NSCopying&amp; NSMutableCopying</span></span><br><span class="line">- (<span class="keyword">id</span>)copyWithZone:(<span class="built_in">NSZone</span> *)zone&#123;</span><br><span class="line">    userName *<span class="keyword">copy</span> = [[[<span class="keyword">self</span> class] allocWithZone:zone]initWithFirstName:_firstName</span><br><span class="line">                                                             andLastName:_lastame];</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">copy</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)mutableCopyWithZone:(<span class="built_in">NSZone</span> *)zone&#123;</span><br><span class="line">    userName *mutableCopy = [[[<span class="keyword">self</span> class] allocWithZone:zone]initWithMutableFirstName:_mutableFirstName</span><br><span class="line">                                                                     andMutableLastame:_mutableLastame];</span><br><span class="line">    <span class="keyword">return</span> mutableCopy;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<h2 id="copy_u548CmutableCopy"><a href="#copy_u548CmutableCopy" class="headerlink" title="copy和mutableCopy"></a>copy和mutableCopy</h2><p>在下面的代码中，我向一个immutable对象发送copy和mutableCopy<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="built_in">NSString</span> *string = <span class="string">@"abc"</span>;</span><br><span class="line">    <span class="built_in">NSString</span> *copyString = [string <span class="keyword">copy</span>];</span><br><span class="line">    <span class="built_in">NSString</span> *mutableCopyString = [string mutableCopy];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"\n%x \n%x \n%x\n"</span>, string, copyString, mutableCopyString);</span><br><span class="line"><span class="comment">// 输出结果: 2118</span></span><br><span class="line"><span class="comment">//          2118</span></span><br><span class="line"><span class="comment">//          200250</span></span><br></pre></td></tr></table></figure></p>
<p>可以看到，copy之后的地址和原地址一样，并不会生成一个新对象；而mutableCopy之后，地址改变，证明生成了一个新的对象。这也很好理解，copy之后的对象还是immutable，并不需要更改，所以为了节省内存的考虑，可以直接生成一个指向对象的指针，使其引用计数+1。</p>
<h2 id="@Property_u4E2D_u7684copy_u548Cstrong_u522B_u4E71_u7528"><a href="#@Property_u4E2D_u7684copy_u548Cstrong_u522B_u4E71_u7528" class="headerlink" title="@Property中的copy和strong别乱用"></a>@Property中的copy和strong别乱用</h2><p>经常可以看到@Property中有些对象属性被strong修饰，或者copy修饰，但是一直都不明白应该怎么修饰。后来看到stackoverflow上有人说到:</p>
<blockquote>
<p>or attributes whose type is an immutable value class that conforms to the NSCopying protocol, you almost always should specify copy in your @property declaration. Specifying retain is something you almost never want in such a situation.</p>
</blockquote>
<p>于是开始知道immutable对象需要用copy来修饰，但是为什么需要copy而不是strong呢?可以看下列的代码：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">    <span class="comment">//用copy关键字修饰属性</span></span><br><span class="line">    <span class="built_in">NSMutableString</span> *mutableFirstName = [<span class="built_in">NSMutableString</span> stringWithFormat:<span class="string">@"吴"</span>];</span><br><span class="line">    <span class="built_in">NSMutableString</span> *mutableLastName = [<span class="built_in">NSMutableString</span> stringWithFormat:<span class="string">@"彦祖"</span>];</span><br><span class="line">    userName *myName = [[userName alloc]init];</span><br><span class="line">    myName<span class="variable">.firstName</span> = mutableFirstName;</span><br><span class="line">    myName<span class="variable">.lastame</span> = mutableLastName;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"My name is %@%@"</span>,myName<span class="variable">.firstName</span>,myName<span class="variable">.lastame</span>);</span><br><span class="line"><span class="comment">//输出结果  2016-03-02 15:24:30.247 copyName[914:18299] My name is 吴彦祖</span></span><br><span class="line"><span class="comment">//        2016-03-02 15:24:30.248 copyName[914:18299] My name is 吴彦祖</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="comment">//用strong关键字修饰属性</span></span><br><span class="line">    [mutableFirstName deleteCharactersInRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">1</span>)];</span><br><span class="line">    [mutableFirstName appendString:<span class="string">@"赵"</span>];</span><br><span class="line">    [mutableLastName deleteCharactersInRange:<span class="built_in">NSMakeRange</span>(<span class="number">0</span>, <span class="number">2</span>)];</span><br><span class="line">    [mutableLastName appendString:<span class="string">@"四"</span>];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"My name is %@%@"</span>,myName<span class="variable">.firstName</span>,myName<span class="variable">.lastame</span>);</span><br><span class="line"><span class="comment">//输出结果  2016-03-02 16:02:43.519 copyName[1097:29163] My name is 吴彦祖</span></span><br><span class="line"><span class="comment">//        2016-03-02 16:02:43.520 copyName[1097:29163] My name is 赵四</span></span><br></pre></td></tr></table></figure>
<p>从输出结果中，可以看出当一个immutable对象被strong修饰时，如果该immutable类存在mutable的父类。那么当immutable对象被mutable对象赋值时，其值会随着mutable对象的值而改变。吴彦祖都可能变成赵四……</p>
<p>参考资料：</p>
<ol>
<li><a href="http://stackoverflow.com/questions/387959/nsstring-property-copy-or-retain" target="_blank" rel="external">NSString property:copy or retain</a></li>
<li>《Effective Objective-C 2.0》 Matt Galloway</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-插入排序" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/25/插入排序/" class="article-date">
  	<time datetime="2016-02-25T14:39:55.000Z" itemprop="datePublished">2016-02-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/25/插入排序/">基本算法--排序</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u4E00_u3001_u63D2_u5165_u6392_u5E8F"><a href="#u4E00_u3001_u63D2_u5165_u6392_u5E8F" class="headerlink" title="一、插入排序"></a>一、插入排序</h2><h3 id="1-1__u76F4_u63A5_u63D2_u5165_u6392_u5E8F"><a href="#1-1__u76F4_u63A5_u63D2_u5165_u6392_u5E8F" class="headerlink" title="1.1 直接插入排序"></a>1.1 直接插入排序</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接插入排序</span></span><br><span class="line">   <span class="keyword">for</span> (i=<span class="number">2</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">       <span class="comment">//当待插入值比有序区的最大值小时，找到待插入的位置插入</span></span><br><span class="line">       <span class="keyword">if</span> (r[i]&lt;r[i-<span class="number">1</span>]) &#123;</span><br><span class="line">           r[<span class="number">0</span>] = r[i];</span><br><span class="line">           <span class="comment">//将比待插入值大的数后移一位</span></span><br><span class="line">           <span class="keyword">for</span> (j=i-<span class="number">1</span>; j&gt;<span class="number">0</span> &amp;&amp; r[j]&gt;r[<span class="number">0</span>]; j--) &#123;</span><br><span class="line">               r[j+<span class="number">1</span>] = r[j];</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//找到待插入的位置插入</span></span><br><span class="line">           r[j+<span class="number">1</span>]=r[<span class="number">0</span>];</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="1-2__u5E0C_u5C14_u6392_u5E8F"><a href="#1-2__u5E0C_u5C14_u6392_u5E8F" class="headerlink" title="1.2 希尔排序"></a>1.2 希尔排序</h3><p>希尔排序相当于把直接插入排序的增量变成了dk<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (dk&gt;<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">1</span>+dk; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (r[i]&lt;r[i-dk]) &#123;</span><br><span class="line">            r[<span class="number">0</span>] = r[i];</span><br><span class="line">            <span class="keyword">for</span> (j=i-dk; j&gt;<span class="number">0</span> &amp;&amp; r[j]&gt;r[<span class="number">0</span>]; j-=dk) &#123;</span><br><span class="line">                r[j+dk] = r[j];</span><br><span class="line">            &#125;</span><br><span class="line">            r[j+dk] = r[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    dk=dk/<span class="number">3</span>+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="u4E8C_u3001_u9009_u62E9_u6392_u5E8F"><a href="#u4E8C_u3001_u9009_u62E9_u6392_u5E8F" class="headerlink" title="二、选择排序"></a>二、选择排序</h2><h3 id="2-1__u7B80_u5355_u9009_u62E9_u6392_u5E8F"><a href="#2-1__u7B80_u5355_u9009_u62E9_u6392_u5E8F" class="headerlink" title="2.1 简单选择排序"></a>2.1 简单选择排序</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> index;<span class="comment">//最小值的序号</span></span><br><span class="line">   <span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">       index = i;</span><br><span class="line">       <span class="keyword">for</span> (j=i+<span class="number">1</span>; j&lt;<span class="number">10</span>; j++) &#123;</span><br><span class="line">           <span class="keyword">if</span> (r[j]&lt;r[i]) &#123;</span><br><span class="line">               index = j;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (index != i) &#123;</span><br><span class="line">           swap(r, i, j);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-2__u5806_u6392_u5E8F"><a href="#2-2__u5806_u6392_u5E8F" class="headerlink" title="2.2 堆排序"></a>2.2 堆排序</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> heapSort(<span class="keyword">int</span> r[])&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="comment">//构建一个大根堆</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">4</span>; i&gt;<span class="number">0</span>; i--) &#123;</span><br><span class="line">        heapAdjust(r, i, <span class="number">9</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将根节点与最后一个叶子节点调换，去除最后一个叶子节点</span></span><br><span class="line">    <span class="keyword">for</span> (i=<span class="number">9</span>; i&gt;<span class="number">1</span>; i--) &#123;</span><br><span class="line">        swap(r, <span class="number">1</span>, i);</span><br><span class="line">        heapAdjust(r, <span class="number">1</span>, i-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//i为子二叉树的根，j表示i较大的子树</span></span><br><span class="line"><span class="keyword">void</span> heapAdjust(<span class="keyword">int</span> r[],<span class="keyword">int</span> i,<span class="keyword">int</span> j)&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp,k;</span><br><span class="line">    tmp = r[i];</span><br><span class="line">    <span class="keyword">for</span> (k=<span class="number">2</span>*i; k&lt;=j; k*=<span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k&lt;j &amp;&amp; r[k]&lt;r[k+<span class="number">1</span>]) &#123;</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (tmp&gt;=r[k]) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        r[i] = r[k];</span><br><span class="line">        i = k;</span><br><span class="line">    &#125;</span><br><span class="line">    r[i]=tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u4E09_u3001_u4EA4_u6362_u6392_u5E8F"><a href="#u4E09_u3001_u4EA4_u6362_u6392_u5E8F" class="headerlink" title="三、交换排序"></a>三、交换排序</h2><h3 id="3-1__u5192_u6CE1_u6392_u5E8F"><a href="#3-1__u5192_u6CE1_u6392_u5E8F" class="headerlink" title="3.1 冒泡排序"></a>3.1 冒泡排序</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//依次交换最小值</span></span><br><span class="line"><span class="keyword">for</span> (i=<span class="number">1</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j=i+<span class="number">1</span>; j&lt;<span class="number">10</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (r[i]&gt;r[j]) &#123;</span><br><span class="line">                swap(r, i, j);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2__u5FEB_u901F_u6392_u5E8F"><a href="#3-2__u5FEB_u901F_u6392_u5E8F" class="headerlink" title="3.2 快速排序"></a>3.2 快速排序</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> quickSort(<span class="keyword">int</span> r[],<span class="keyword">int</span> low,<span class="keyword">int</span> high)&#123;</span><br><span class="line">    <span class="keyword">int</span> pivot;</span><br><span class="line">    <span class="keyword">if</span> (high &gt; low) &#123;</span><br><span class="line">        pivot = partition(r, low, high);</span><br><span class="line">        <span class="comment">//以pivot划分两个待排序区</span></span><br><span class="line">        quickSort(r,low,pivot-<span class="number">1</span>);</span><br><span class="line">        quickSort(r,pivot+<span class="number">1</span>,high);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//一躺快速排序</span></span><br><span class="line"><span class="keyword">int</span> partition(<span class="keyword">int</span> r[],<span class="keyword">int</span> low,<span class="keyword">int</span> high)&#123;</span><br><span class="line">    <span class="keyword">int</span> pivotkey=r[low];</span><br><span class="line">    <span class="keyword">while</span> (high&gt;low) &#123;</span><br><span class="line">        <span class="keyword">while</span> (high&gt;low &amp;&amp; pivotkey&lt;r[high])</span><br><span class="line">            high--;</span><br><span class="line">        swap(r, low, high);</span><br><span class="line">        <span class="keyword">while</span> (high&gt;low &amp;&amp; pivotkey&gt;r[low])</span><br><span class="line">            low++;</span><br><span class="line">        swap(r, low, high);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> low;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u56DB_u3001_u5F52_u5E76_u6392_u5E8F"><a href="#u56DB_u3001_u5F52_u5E76_u6392_u5E8F" class="headerlink" title="四、归并排序"></a>四、归并排序</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> mergeSort(<span class="keyword">int</span> r[])&#123;</span><br><span class="line">    mSort(r, r, <span class="number">1</span>, <span class="number">9</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//将SR[i..j]归并排序为TR[i..j]</span></span><br><span class="line"><span class="keyword">void</span> mSort(<span class="keyword">int</span> SR[],<span class="keyword">int</span> TR[],<span class="keyword">int</span> i,<span class="keyword">int</span> j)&#123;</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="keyword">int</span> TR1[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">if</span> (i == j)</span><br><span class="line">        TR[i] = SR[i];</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        m = (i+j)/<span class="number">2</span>;</span><br><span class="line">        mSort(SR, TR1, i, m);</span><br><span class="line">        mSort(SR, TR1, m+<span class="number">1</span>, j);</span><br><span class="line">        merge(TR1, TR, i, m, j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//TR1[i..k]与TR1[k+1..j]合并成TR[i..j]</span></span><br><span class="line"><span class="keyword">void</span> merge(<span class="keyword">int</span> TR1[],<span class="keyword">int</span> TR[],<span class="keyword">int</span> low,<span class="keyword">int</span> mid,<span class="keyword">int</span> high)&#123;</span><br><span class="line">    <span class="keyword">int</span> i,j,k;</span><br><span class="line">    i = low;</span><br><span class="line">    j = mid+<span class="number">1</span>;</span><br><span class="line">    k = low;</span><br><span class="line">    <span class="keyword">while</span> (i&lt;=mid &amp;&amp; j&lt;=high) &#123;</span><br><span class="line">        <span class="keyword">if</span> (TR1[i]&lt;TR1[j]) &#123;</span><br><span class="line">            TR[k++] = TR1[i++];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            TR[k++] = TR1[j++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (i&lt;=mid)</span><br><span class="line">        TR[k++] = TR1[i++];</span><br><span class="line">    <span class="keyword">while</span>(j&lt;=high)</span><br><span class="line">        TR[k++] = TR1[j++];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u4E94_u3001_u6392_u5E8F_u65B9_u6CD5_u6BD4_u8F83"><a href="#u4E94_u3001_u6392_u5E8F_u65B9_u6CD5_u6BD4_u8F83" class="headerlink" title="五、排序方法比较"></a>五、排序方法比较</h2><table>
<thead>
<tr>
<th>排序方法</th>
<th style="text-align:center">平均情况</th>
<th style="text-align:right">最好情况</th>
<th style="text-align:right">最坏情况</th>
<th style="text-align:right">辅助空间</th>
<th style="text-align:right">稳定性</th>
</tr>
</thead>
<tbody>
<tr>
<td>直接插入排序</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:right">O(n)</td>
<td style="text-align:right">O(n^2)</td>
<td style="text-align:right">O(1)</td>
<td style="text-align:right">稳定</td>
</tr>
<tr>
<td>简单选择排序</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:right">O(n^2)</td>
<td style="text-align:right">O(n^2)</td>
<td style="text-align:right">O(1)</td>
<td style="text-align:right">稳定</td>
</tr>
<tr>
<td>冒泡排序</td>
<td style="text-align:center">O(n^2)</td>
<td style="text-align:right">O(n)</td>
<td style="text-align:right">O(n^2)</td>
<td style="text-align:right">O(1)</td>
<td style="text-align:right">稳定</td>
</tr>
<tr>
<td>希尔排序</td>
<td style="text-align:center">O(nlogn)~O(n^2)</td>
<td style="text-align:right">O(n^1.3)</td>
<td style="text-align:right">O(n^2)</td>
<td style="text-align:right">O(1)</td>
<td style="text-align:right">不稳定</td>
</tr>
<tr>
<td>堆排序</td>
<td style="text-align:center">O(nlogn)</td>
<td style="text-align:right">O(nlogn)</td>
<td style="text-align:right">O(nlogn)</td>
<td style="text-align:right">O(1)</td>
<td style="text-align:right">不稳定</td>
</tr>
<tr>
<td>快速排序</td>
<td style="text-align:center">O(nlogn)</td>
<td style="text-align:right">O(nlogn)</td>
<td style="text-align:right">O(n^2)</td>
<td style="text-align:right">O(logn)~O(n)</td>
<td style="text-align:right">不稳定</td>
</tr>
<tr>
<td>归并排序</td>
<td style="text-align:center">O(nlogn)</td>
<td style="text-align:right">O(nlogn)</td>
<td style="text-align:right">O(nlogn)</td>
<td style="text-align:right">O(n)</td>
<td style="text-align:right">稳定</td>
</tr>
</tbody>
</table>
<p>参考资料:<br>1.《大话数据结构》 程杰<br>2.《数据结构（c语言版）》 严蔚敏 吴伟民</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-纸牌游戏" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/24/纸牌游戏/" class="article-date">
  	<time datetime="2016-02-24T12:20:42.000Z" itemprop="datePublished">2016-02-24</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/24/纸牌游戏/">纸牌游戏</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近被同学推荐看了一下Stanford的iOS开放教程，于是自己动手做了一下前3讲提到的Machismo游戏。</p>
<h3 id="UI_u8BBE_u8BA1"><a href="#UI_u8BBE_u8BA1" class="headerlink" title="UI设计"></a>UI设计</h3><p>在一张桌布上摆放12个UIButton作为纸牌，点击时翻面。</p>
<p><img src="http://7xqzfr.com1.z0.glb.clouddn.com/Simulator%20Screen%20Shot%202016%E5%B9%B42%E6%9C%8828%E6%97%A5%20%E4%B8%8B%E5%8D%887.57.51.png?imageView/2/w/300/q/90" alt=""></p>
<h3 id="u6E38_u620F_u89C4_u5219"><a href="#u6E38_u620F_u89C4_u5219" class="headerlink" title="游戏规则"></a>游戏规则</h3><p>点击一张纸牌A，翻面。再点击一张纸牌B，翻面后，存在以下几种情况：</p>
<ol>
<li>A与B的点数相同，两张纸牌同时被锁定，score+4;</li>
<li>A与B的花色相同，两张纸牌同时被锁定，score+2;</li>
<li>A与B的点数和花色都不同，A翻面,score-1.<h3 id="u5B9E_u9645_u6548_u679C"><a href="#u5B9E_u9645_u6548_u679C" class="headerlink" title="实际效果"></a>实际效果</h3><img src="http://7xqzfr.com1.z0.glb.clouddn.com/2016-02-28%2020_04_03.gif?imageView/2/w/300/q/90" alt=""></li>
</ol>
<p>代码Demo<a href="https://github.com/oushiyq/iOSdemos/tree/master/cardMatch2" target="_blank" rel="external">在这</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-简易微信红包" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/17/简易微信红包/" class="article-date">
  	<time datetime="2016-02-17T06:41:19.000Z" itemprop="datePublished">2016-02-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/17/简易微信红包/">简易微信红包</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="u5199_u5728_u524D_u9762"><a href="#u5199_u5728_u524D_u9762" class="headerlink" title="写在前面"></a>写在前面</h4><p>这几天过年一直在玩微信红包，抢来抢去也就几块钱，还随时得关注群里的红包动态。思来想起，还不如自己做个简易微信红包过过干瘾。好吧，说干就干！</p>
<h2 id="UI_u8BBE_u8BA1"><a href="#UI_u8BBE_u8BA1" class="headerlink" title="UI设计"></a>UI设计</h2><p>简单设计了5个标签表示5个不同用户，5个UITextField用来显示抢到的红包，5个UIButton实现抢红包（虽然在这个demo中每人都有红包。。。）。功能实现需满足下列条件：</p>
<ol>
<li>拆红包顺序不固定</li>
<li>拆完红包以后，拆红包按钮无法继续点击</li>
</ol>
<p><img src="http://7xqzfr.com1.z0.glb.clouddn.com/Simulator%20Screen%20Shot%202016%E5%B9%B42%E6%9C%8822%E6%97%A5%20%E4%B8%8B%E5%8D%883.06.55.png?imageView/2/w/300/q/90" alt=""> </p>
<h2 id="u62A2_u7EA2_u5305_u7B97_u6CD5"><a href="#u62A2_u7EA2_u5305_u7B97_u6CD5" class="headerlink" title="抢红包算法"></a>抢红包算法</h2><p>抢红包算法主要需满足下列几点</p>
<ol>
<li>保证每人都有红包可以拿到</li>
<li>最小的红包为0.01</li>
<li>每人的红包相加后为100</li>
<li>金额随机分配</li>
</ol>
<p>代码实现如下所示：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"> - (<span class="built_in">NSArray</span>*)disMoney&#123;</span><br><span class="line">    <span class="keyword">float</span> tmpMoney[<span class="number">5</span>];</span><br><span class="line">    <span class="keyword">float</span> maxMoney = <span class="number">99.96</span>;<span class="comment">//第一个人最多只能抢到99.96元</span></span><br><span class="line">    <span class="keyword">float</span> sum = <span class="number">0</span> ;</span><br><span class="line">    <span class="built_in">NSMutableArray</span> *luckyMoney = [[<span class="built_in">NSMutableArray</span> alloc]init];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//红包分配</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//当第一个人抢完后，从第二人开始最大红包减去前一个红包</span></span><br><span class="line">            maxMoney -= tmpMoney[i - <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i != <span class="number">4</span>) &#123;</span><br><span class="line">            tmpMoney[i] = arc4random() % <span class="number">100</span> / <span class="number">100.00</span> * maxMoney;<span class="comment">//生成0~maxMoney之间的随机数</span></span><br><span class="line">            <span class="keyword">int</span> a = (<span class="keyword">int</span>)(tmpMoney[i] * <span class="number">100</span> + <span class="number">0.5</span>);</span><br><span class="line">            tmpMoney[i] = a / <span class="number">100.0</span> + <span class="number">0.01</span>;<span class="comment">//四舍五入，取两位小数</span></span><br><span class="line">            <span class="built_in">NSString</span> *tmp = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%.2f"</span>,tmpMoney[i] ];</span><br><span class="line">            [luckyMoney addObject:tmp];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            tmpMoney[i] = <span class="number">100</span> - sum;</span><br><span class="line">            <span class="built_in">NSString</span> *tmp = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%.2f"</span>,tmpMoney[i] ];</span><br><span class="line">            [luckyMoney addObject:tmp];</span><br><span class="line">        &#125;</span><br><span class="line">        sum += tmpMoney[i];</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> luckyMoney;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="u6700_u7EC8_u6548_u679C"><a href="#u6700_u7EC8_u6548_u679C" class="headerlink" title="最终效果"></a>最终效果</h2><p><img src="http://7xqzfr.com1.z0.glb.clouddn.com/2016-02-22%2015_17_27.gif?imageView/2/w/300/q/90" alt=""></p>
<p>代码Demo<a href="https://github.com/oushiyq/luckyMoney" target="_blank" rel="external">在这</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-iOS编程中一些类似的概念" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/29/iOS编程中一些类似的概念/" class="article-date">
  	<time datetime="2016-01-29T07:29:36.000Z" itemprop="datePublished">2016-01-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/29/iOS编程中一些类似的概念/">iOS编程中一些类似的概念</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="self_u4E0Esuper"><a href="#self_u4E0Esuper" class="headerlink" title="self与super"></a>self与super</h2><p>写过objc的程序猿对这俩个对象应该都已经写烂了吧，每次进行init基本都会敲一段以下代码：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (instancetype)init&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        statements</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>self是一个隐式局部变量，代表当前方法的调用者，相当于JAVA中的this；</li>
<li><p>super某种意义上来说相当于self，当向super发消息时，其实是向self发消息。但是系统在查找方法时会跳过当前对象，从父类开始查找。</p>
<p>  在调用父类指定初始化方法之后，代码检查父类的初始化结果，如果不能正确初始化，就会返回nil。</p>
</li>
</ul>
<h2 id="bounds_u4E0Eframe"><a href="#bounds_u4E0Eframe" class="headerlink" title="bounds与frame"></a>bounds与frame</h2><ul>
<li>bounds表示矩形位于自己的坐标系，表示自身。用于确定绘制区域，避免将自己绘制到自己的图层外面；</li>
<li>frame表示矩形位于父视图的坐标系，相对于父视图。用于确定与视图层次结构中其他视图的相对位置。</li>
</ul>
<h2 id="viewDidLoad_uFF1A_u4E0EviewWillAppear_uFF1A"><a href="#viewDidLoad_uFF1A_u4E0EviewWillAppear_uFF1A" class="headerlink" title="viewDidLoad：与viewWillAppear："></a>viewDidLoad：与viewWillAppear：</h2><ul>
<li>viewDidLoad：在视图控制器加载完NIB文件后被调用，只设置一次视图对象；</li>
<li>viewWillAppear：在视图控制器的view添加到引用窗口之前被调用，视图控制器view被加载都进行设置。</li>
</ul>
<h2 id="@class_u4E0E_23import"><a href="#@class_u4E0E_23import" class="headerlink" title="@class与#import"></a>@class与#import</h2><ul>
<li>@class用于定义类，编译器无须知道其实现细节。当某个文件使用@class声明类时，当其头文件发生变化时，编译器不用重新编译，节约编程时间。但是无法向该类实例化后的对象发送消息；</li>
<li>#import引入头文件，可以对头文件的类发送消息，使编译器知道所有的实现细节。</li>
</ul>
<ul>
<li>参考资料 《iOS编程（第4版）》 Christian Keur， Aaron Hillegass &amp; Joe Conway</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-本地通知-for-iOS8-later" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/28/本地通知-for-iOS8-later/" class="article-date">
  	<time datetime="2016-01-28T10:11:26.000Z" itemprop="datePublished">2016-01-28</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/28/本地通知-for-iOS8-later/">本地通知 for iOS8 &amp; later</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u7B80_u5355_u8BB0_u4E00_u7B14"><a href="#u7B80_u5355_u8BB0_u4E00_u7B14" class="headerlink" title="简单记一笔"></a>简单记一笔</h2><p>今天在写一个简单代码，用到了本地通知，代码如下</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">IBAction</span>)addReminder:(<span class="keyword">id</span>)sender&#123;</span><br><span class="line">    <span class="built_in">NSDate</span> *reminderDate = [datePicker date];</span><br><span class="line">    <span class="built_in">UILocalNotification</span> *notice = [[<span class="built_in">UILocalNotification</span> alloc]init];</span><br><span class="line">    notice<span class="variable">.alertBody</span> = <span class="string">@"Hypnotize me"</span>;</span><br><span class="line">    notice<span class="variable">.fireDate</span> = reminderDate;</span><br><span class="line">    </span><br><span class="line">    [[<span class="built_in">UIApplication</span> sharedApplication] scheduleLocalNotification:notice];</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码没错，不过控制台出现了这样一行错误：</p>
<blockquote>
<p>Attempting to schedule a local notification ，with an alert but haven’t received permission from the user to display alerts，with a sound but haven’t received permission from the user to play sounds</p>
</blockquote>
<ul>
<li>原因在于iOS8以后，系统需要在appdelegate中进行注册，才能实现本地通知。于是需要在appdelegate.m中加入下列代码：<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</span><br><span class="line">    <span class="comment">// Override point for customization after application launch.</span></span><br><span class="line">    [application registerUserNotificationSettings:[<span class="built_in">UIUserNotificationSettings</span> settingsForTypes:<span class="built_in">UIUserNotificationTypeAlert</span>|<span class="built_in">UIUserNotificationTypeBadge</span>|<span class="built_in">UIUserNotificationTypeSound</span> categories:<span class="literal">nil</span>]];<span class="comment">//注册本地推送</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="P-S_uFF1A_u81EA_u5B66_u7684_u8FC7_u7A0B_u8FD8_u662F_u6BD4_u8F83_u7D2F_u4EBA_uFF0C_u5F88_u591A_u4E66_u4E0A_u6216_u8005blog_u4E0A_u7684_u65B9_u6CD5_u90FD_u662F_u6BD4_u8F83_u8001_u7684_uFF0C_u800C_u82F9_u679C_u516C_u53F8_u53C8_u4E00_u76F4_u5728_u66F4_u65B0_u65B0_u7684_u5185_u5BB9_uFF0C_u5F88_u591A_u8FC7_u65F6_u7684_u4E1C_u897F_u5728_u65B0_u7248_u672C_u7684_u7CFB_u7EDF_u4E2D_u5DF2_u7ECF_u6452_u5F03_u4E86_u3002"><a href="#P-S_uFF1A_u81EA_u5B66_u7684_u8FC7_u7A0B_u8FD8_u662F_u6BD4_u8F83_u7D2F_u4EBA_uFF0C_u5F88_u591A_u4E66_u4E0A_u6216_u8005blog_u4E0A_u7684_u65B9_u6CD5_u90FD_u662F_u6BD4_u8F83_u8001_u7684_uFF0C_u800C_u82F9_u679C_u516C_u53F8_u53C8_u4E00_u76F4_u5728_u66F4_u65B0_u65B0_u7684_u5185_u5BB9_uFF0C_u5F88_u591A_u8FC7_u65F6_u7684_u4E1C_u897F_u5728_u65B0_u7248_u672C_u7684_u7CFB_u7EDF_u4E2D_u5DF2_u7ECF_u6452_u5F03_u4E86_u3002" class="headerlink" title="P.S：自学的过程还是比较累人，很多书上或者blog上的方法都是比较老的，而苹果公司又一直在更新新的内容，很多过时的东西在新版本的系统中已经摒弃了。"></a>P.S：自学的过程还是比较累人，很多书上或者blog上的方法都是比较老的，而苹果公司又一直在更新新的内容，很多过时的东西在新版本的系统中已经摒弃了。</h3>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Daniel Young
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>