
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>简单使用KVO | Daniel Young&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Daniel Young">
    
    <meta name="description" content="1. KVC的概念KVC（key-value coding）是指将表示对象包含的信息的字符串作为键值来使用，间接访问该信息的方式。
2. KVO与RuntimeKVO（key-value observe）即某个对象的属性改变时通知其他对象的机制。KVO的实现也依赖于Objective-C的Runti">
    
    
    
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.svg" alt="Daniel Young&#39;s blog" title="Daniel Young&#39;s blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Daniel Young&#39;s blog">Daniel Young&#39;s blog</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/16/深入理解KVO/" title="简单使用KVO" itemprop="url">简单使用KVO</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://yoursite.com" title="Daniel Young">Daniel Young</a>
    </p>
  <p class="article-time">
    <time datetime="2016-03-16T12:03:19.000Z" itemprop="datePublished">2016-03-16</time>
    更新日期:<time datetime="2016-03-17T01:38:35.000Z" itemprop="dateModified">2016-03-17</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-_KVC_u7684_u6982_u5FF5"><span class="toc-number">1.</span> <span class="toc-text">1. KVC的概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-_KVO_u4E0ERuntime"><span class="toc-number">2.</span> <span class="toc-text">2. KVO与Runtime</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-_KVO_u7684_u4F7F_u7528"><span class="toc-number">3.</span> <span class="toc-text">3. KVO的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1__u8BA2_u9605"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 订阅</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2__u54CD_u5E94"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3__u79FB_u9664"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 移除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4__u793A_u4F8B_u7A0B_u5E8F"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 示例程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4__u6CE8_u610F_u4E8B_u9879"><span class="toc-number">4.</span> <span class="toc-text">3.4 注意事项</span></a></li></ol>
		</div>
		
		<h2 id="1-_KVC_u7684_u6982_u5FF5"><a href="#1-_KVC_u7684_u6982_u5FF5" class="headerlink" title="1. KVC的概念"></a>1. KVC的概念</h2><p>KVC（key-value coding）是指将表示对象包含的信息的字符串作为键值来使用，间接访问该信息的方式。</p>
<h2 id="2-_KVO_u4E0ERuntime"><a href="#2-_KVO_u4E0ERuntime" class="headerlink" title="2. KVO与Runtime"></a>2. KVO与Runtime</h2><p>KVO（key-value observe）即某个对象的属性改变时通知其他对象的机制。KVO的实现也依赖于Objective-C的Runtime，官方文档《Key-Value Observing Programming Guide》中在《Key-Value Observing Implementation Details》部分简单提到它的实现：</p>
<hr>
<p>Automatic key-value observing is implemented using a technique called isa-swizzling.</p>
<p>The isa pointer, as the name suggests, points to the object’s class which maintains a dispatch table. This dispatch table essentially contains pointers to the methods the class implements, among other data.</p>
<p>When an observer is registered for an attribute of an object the isa pointer of the observed object is modified, pointing to an intermediate class rather than at the true class. As a result the value of the isa pointer does not necessarily reflect the actual class of the instance.</p>
<p>You should never rely on the isa pointer to determine class membership. Instead, you should use the class method to determine the class of an object instance.</p>
<hr>
<p>大概的意思就是KVO的实现是通过isa-swizzling技术。这个技术表示，当观察者观察一个对象时，会产生一个新的类，这个类继承于被观察对象，并重写其setter方法，再将被观察对象的isa指针指向新的类。这样被观察对象就神奇的成为了新类的实例。这样看来，KVO的实现还是有点黑魔法的意思啊。</p>
<h2 id="3-_KVO_u7684_u4F7F_u7528"><a href="#3-_KVO_u7684_u4F7F_u7528" class="headerlink" title="3. KVO的使用"></a>3. KVO的使用</h2><h3 id="3-1__u8BA2_u9605"><a href="#3-1__u8BA2_u9605" class="headerlink" title="3.1 订阅"></a>3.1 订阅</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)addObserver:(<span class="built_in">NSObject</span> *)observer</span><br><span class="line">         forKeyPath:(<span class="built_in">NSString</span> *)keyPath</span><br><span class="line">            options:(<span class="built_in">NSKeyValueObservingOptions</span>)options</span><br><span class="line">            context:(<span class="keyword">void</span> *)context;</span><br></pre></td></tr></table></figure>
<h3 id="3-2__u54CD_u5E94"><a href="#3-2__u54CD_u5E94" class="headerlink" title="3.2 响应"></a>3.2 响应</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath</span><br><span class="line">                      ofObject:(<span class="keyword">id</span>)object</span><br><span class="line">                        change:(<span class="built_in">NSDictionary</span> *)change</span><br><span class="line">                       context:(<span class="keyword">void</span> *)context;</span><br></pre></td></tr></table></figure>
<h3 id="3-3__u79FB_u9664"><a href="#3-3__u79FB_u9664" class="headerlink" title="3.3 移除"></a>3.3 移除</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="built_in">NSObject</span> *)observer</span><br><span class="line">            forKeyPath:(<span class="built_in">NSString</span> *)keyPath</span><br><span class="line">               context:(<span class="keyword">void</span> *)context;</span><br><span class="line">               </span><br><span class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="built_in">NSObject</span> *)observer</span><br><span class="line">            forKeyPath:(<span class="built_in">NSString</span> *)keyPath;</span><br></pre></td></tr></table></figure>
<h3 id="3-4__u793A_u4F8B_u7A0B_u5E8F"><a href="#3-4__u793A_u4F8B_u7A0B_u5E8F" class="headerlink" title="3.4 示例程序"></a>3.4 示例程序</h3><p>在下面的例子中，通过对UITextField.text值的观察，当其变化时，新值将在弹出窗口中被打印出来。效果如下：<br><img src="http://7xqzfr.com1.z0.glb.clouddn.com/2016-03-17%2009_36_54.gif" alt=""></p>
<p>以下是源代码：<br>h文件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> : <span class="title">UIViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *showText;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) IBOutletCollection(<span class="built_in">UIButton</span>) <span class="built_in">NSArray</span> *numberButton;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)clickNumberButton:(<span class="keyword">id</span>)sender;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>m文件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"ViewController.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad&#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    [<span class="keyword">self</span> addObserver:<span class="keyword">self</span></span><br><span class="line">           forKeyPath:<span class="string">@"showText.text"</span></span><br><span class="line">              options:<span class="number">1</span></span><br><span class="line">              context:<span class="literal">NULL</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">IBAction</span>)clickNumberButton:(<span class="keyword">id</span>)sender &#123;</span><br><span class="line">    <span class="built_in">NSUInteger</span> buttonIndex = [<span class="keyword">self</span><span class="variable">.numberButton</span> indexOfObject:sender];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *content = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%lu"</span>,(<span class="keyword">unsigned</span> <span class="keyword">long</span>)buttonIndex ];</span><br><span class="line">    [content stringByAppendingFormat:<span class="string">@"%lu"</span>,(<span class="keyword">unsigned</span> <span class="keyword">long</span>)buttonIndex];</span><br><span class="line">    <span class="keyword">self</span><span class="variable">.showText</span><span class="variable">.text</span> = [<span class="keyword">self</span><span class="variable">.showText</span><span class="variable">.text</span> stringByAppendingString:content];</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath</span><br><span class="line">                      ofObject:(<span class="keyword">id</span>)object</span><br><span class="line">                        change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSString</span> *,<span class="keyword">id</span>&gt; *)change</span><br><span class="line">                       context:(<span class="keyword">void</span> *)context&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *currentString = [change valueForKey:<span class="string">@"new"</span>];</span><br><span class="line">    <span class="comment">//弹窗</span></span><br><span class="line">    <span class="built_in">UIAlertController</span> *alertController = [<span class="built_in">UIAlertController</span> alertControllerWithTitle:<span class="string">@"输入的数字为："</span></span><br><span class="line">                                                                             message:currentString</span><br><span class="line">                                                                      preferredStyle:<span class="built_in">UIAlertControllerStyleAlert</span>];</span><br><span class="line">    <span class="built_in">UIAlertAction</span> *cancelAction = [<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"取消"</span></span><br><span class="line">                                                           style:<span class="built_in">UIAlertActionStyleCancel</span></span><br><span class="line">                                                         handler:<span class="literal">nil</span>];</span><br><span class="line">    <span class="built_in">UIAlertAction</span> *okAction = [<span class="built_in">UIAlertAction</span> actionWithTitle:<span class="string">@"好的"</span></span><br><span class="line">                                                       style:<span class="built_in">UIAlertActionStyleDefault</span></span><br><span class="line">                                                     handler:<span class="literal">nil</span>];</span><br><span class="line">    [alertController addAction:cancelAction];</span><br><span class="line">    [alertController addAction:okAction];</span><br><span class="line">    [<span class="keyword">self</span> presentViewController:alertController animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-4__u6CE8_u610F_u4E8B_u9879"><a href="#3-4__u6CE8_u610F_u4E8B_u9879" class="headerlink" title="3.4 注意事项"></a>3.4 注意事项</h2><ol>
<li>keypath的拼写。因为keypath为一字符串，所以很容易产生拼写错误导致无法监听。比如本来keypath = @”contents”，但有时未注意可能会拼写成keypath = @”content”，而编译器在编译时也无法发现错误。因此可以定义一个常量static const NSString *contens = @”contents”；</li>
<li>多次使用removeObserver导致程序crash。在同一个文件中执行两次相同的removeObserver比较容易debug出来；但是跨文件执行两次相同的removeObserver就不是那么容易发现了。因此Apple推荐在dealloc中进行removeObserver；</li>
</ol>
<p>参考资料：</p>
<ol>
<li>Key-Value Observing Programming Guide</li>
<li><a href="http://objccn.io/issue-7-3/" target="_blank" rel="external">KVC 和 KVO</a> 翻译：卢思豪 </li>
<li><a href="http://khanlou.com/2013/12/kvo-considered-harmful/" target="_blank" rel="external">KVO Considered Harmful</a> KHANLOU</li>
<li>《Objective-C编程全解》 荻原刚志</li>
</ol>
  
	</div>
		<footer class="article-footer clearfix">




<div class="article-share" id="share">

  <div data-url="http://yoursite.com/2016/03/16/深入理解KVO/" data-title="简单使用KVO | Daniel Young&#39;s blog" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2016/03/23/理解Runtime之消息转发/" title="理解Runtime之消息转发">
  <strong>PREVIOUS:</strong><br/>
  <span>
  理解Runtime之消息转发</span>
</a>
</div>


<div class="next">
<a href="/2016/03/11/ARC模式下的OC对象与Core-Fundation的桥接/"  title="ARC模式下的OC对象与Core Fundation的桥接">
 <strong>NEXT:</strong><br/> 
 <span>ARC模式下的OC对象与Core Fundation的桥接
</span>
</a>
</div>

</nav>

	
</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-_KVC_u7684_u6982_u5FF5"><span class="toc-number">1.</span> <span class="toc-text">1. KVC的概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-_KVO_u4E0ERuntime"><span class="toc-number">2.</span> <span class="toc-text">2. KVO与Runtime</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-_KVO_u7684_u4F7F_u7528"><span class="toc-number">3.</span> <span class="toc-text">3. KVO的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1__u8BA2_u9605"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 订阅</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2__u54CD_u5E94"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 响应</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3__u79FB_u9664"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 移除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4__u793A_u4F8B_u7A0B_u5E8F"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 示例程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4__u6CE8_u610F_u4E8B_u9879"><span class="toc-number">4.</span> <span class="toc-text">3.4 注意事项</span></a></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  

  

  <div class="rsspart">
	<a href="null" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font clearfix">
		
		
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2016 
		
		<a href="http://yoursite.com" target="_blank" title="Daniel Young">Daniel Young</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>






  </body>
</html>
